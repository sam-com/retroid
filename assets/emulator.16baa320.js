import"./modulepreload-polyfill.b7f2da20.js";function c(e,t){e.postMessage(t,"*")}var o=(e=>(e.ready="ready",e.initialized="initialized",e))(o||{});function h(e,t){switch(e.type){case"start":return t.start();case"restart":return t.restart();case"pause":return t.pause();case"resume":return t.resume();case"initialize":return t.initializeCoreAndRom(e.payload);case"changeAspect":return t.changeAspectRatio();default:throw new Error(`Unsuported Emulator message: ${e} `)}}function w(e){window.onmessage=t=>h(t.data,e)}async function d(e){return new Promise(t=>{const r=document.getElementById("canvas"),n=document.createElement("script");n.src=`/retroid//cores/${e}_libretro.js`,n.onerror=a=>{alert(a)},n.onload=()=>(console.log("core loaded"),t()),r==null||r.appendChild(n)})}function m(e,t){return new Promise((r,n)=>{fetch(e,{method:"GET"}).then(a=>a.ok?r(a[t]()):n(`getFile -> Unable to fetch file at ${e}`))})}var i=(e=>(e.BUNDLE="home/web_user/retroarch/bundle",e.USERDATA="home/web_user/retroarch/userdata",e.CONFIG="/home/web_user/retroarch/userdata/retroarch.cfg",e.ROM="/rom.bin",e.STATE="/home/web_user/retroarch/userdata/states/rom.state",e.SCREENSHOT="/home/web_user/retroarch/userdata/screenshots/",e))(i||{});async function u(e){const t=`/retroid//roms/${e}`;let r=await m(t,"blob");if(!r)throw new Error(`loadRom ->  Unable to fetch rom at ${e}`);const n=await r.arrayBuffer(),a=new Uint8Array(n);FS.createPath("/",i.USERDATA,!0,!0),FS.writeFile(i.ROM,a),console.log("rom loaded")}function p(e,t){const{offsetWidth:r,offsetHeight:n}=e;if(!t)return[r,n];const{innerWidth:a,innerHeight:l}=window,s=Math.min(a/r,l/n);return[r*s,n*s]}function f(e){return window.Module={canvas:e,noInitialRun:!0,onRuntimeInitialized:()=>{},print:()=>{},printErr:()=>{},arguments:["/rom.bin","--verbose"]},window.Module}class y{constructor(){this.canvas=document.getElementById("canvas"),this.container=document.getElementById("canvas-container"),this.module=f(this.canvas),this.parent=window.top,this.ready=!1,this.started=!1,this.originalRatio=!0,c(this.parent,{type:o.initialized}),window.addEventListener("resize",this.resize.bind(this),!1)}start(){this.module.callMain(window.Module.arguments),requestAnimationFrame(()=>{this.resize()})}restart(){window.location.href=window.location.href}async initializeCoreAndRom({core:t,rom:r}){await d(t),await u(r),c(this.parent,{type:o.ready})}async loadCore(t){await d(t)}async loadRom(t){await u(t)}pause(){this.module.pauseMainLoop()}resume(){this.module.resumeMainLoop()}changeAspectRatio(){this.originalRatio=!this.originalRatio,this.resize()}resize(){const[t,r]=p(this.container,this.originalRatio);this.module.setCanvasSize(t,r,!1)}}const g=new y;w(g);window.parent.addEventListener("keydown",e=>{const t=new KeyboardEvent("keydown",e);document.dispatchEvent(t)});window.parent.addEventListener("keyup",e=>{const t=new KeyboardEvent("keyup",e);document.dispatchEvent(t)});
